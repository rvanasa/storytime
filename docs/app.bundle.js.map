{"version":3,"sources":["webpack:///webpack/bootstrap ce806cc21e2586d539fe","webpack:///./www/app/main.js","webpack:///./www/style/main.css?d214","webpack:///./~/camelize/index.js","webpack:///./www/app \\.component\\.js$/","webpack:///./www/app/component/app/app.component.js","webpack:///./www/app/component/app/app.html","webpack:///./www/app \\.directive\\.js$/","webpack:///./www/app \\.provider\\.js$/","webpack:///./www/app \\.constant\\.js$/","webpack:///./www/app \\.value\\.js$/","webpack:///./www/app \\.service\\.js$/","webpack:///./www/app/service/story.service.js","webpack:///./www/app/service/xml-context.service.js","webpack:///./www/app \\.factory\\.js$/","webpack:///./www/app/factory/context.factory.js","webpack:///./www/app/factory/parser.factory.js","webpack:///./www/app/factory/range-composer.factory.js","webpack:///./www/app/factory/storage.factory.js","webpack:///./www/app/factory/util.factory.js","webpack:///./www/app \\.filter\\.js$/","webpack:///./www/app \\.run\\.js$/","webpack:///./www/app \\.config\\.js$/"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;AChDA,0C;;;;;;;;;ACAA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK,IAAI;AACT;;AAEA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oBAAmB,eAAe;AAClC;AACA;AACA;AACA;;AAEA;AACA;AACA,oBAAmB,eAAe;AAClC;AACA;AACA;AACA;;;;;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,uDAAuD;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACdA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,G;;;;;;AC/CA,2FAA0F,wEAAwE,oFAAoF,SAAS,6EAA6E,YAAY,gbAAgb,2BAA2B,eAAe,wEAAwE,+H;;;;;;ACA13B;AACA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,uDAAuD;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA,KAAI;AACJ;;AAEA;AACA;AACA;AACA,iBAAgB,oFAAoF;;AAEpG;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,E;;;;;;AC9EA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,oBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mEAAkE;AAClE;AACA;AACA,IAAG;AACH;AACA,E;;;;;;AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC,uDAAuD;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,cAAa;AACb,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,gDAA+C;AAC/C,KAAI;AACJ;AACA;AACA,E;;;;;;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe,IAAI,IAAI;AACvB;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,E;;;;;;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,E;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;AACH;AACA,E;;;;;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,E;;;;;;ACRA;AACA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA,mCAAkC,WAAW;AAC7C;AACA;AACA","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ce806cc21e2586d539fe","require('../style/main.css');\r\n\r\nvar camelize = require('camelize');\r\n\r\nvar angular = window.angular;\r\n\r\nvar app = angular.module('app', ['ui.bootstrap']);\r\n\r\nregister('component', require.context('.', true, /\\.component\\.js$/i));\r\nregister('directive', require.context('.', true, /\\.directive\\.js$/i));\r\nregister('provider', require.context('.', true, /\\.provider\\.js$/i));\r\nregister('constant', require.context('.', true, /\\.constant\\.js$/i));\r\nregister('value', require.context('.', true, /\\.value\\.js$/i));\r\nregister('service', require.context('.', true, /\\.service\\.js$/i));\r\nregister('factory', require.context('.', true, /\\.factory\\.js$/i));\r\nregister('filter', require.context('.', true, /\\.filter\\.js$/i));\r\n\r\nregisterSpecial('run', require.context('.', true, /\\.run\\.js$/i));\r\nregisterSpecial('config', require.context('.', true, /\\.config\\.js$/i));\r\n\r\nangular.element(() => angular.bootstrap(document, ['app']));\r\n\r\nfunction requireAll(context)\r\n{\r\n\treturn context.keys().map(path =>\r\n\t{\r\n\t\tvar index = path.lastIndexOf('/') + 1;\r\n\t\treturn {\r\n\t\t\tname: camelize(path.substring(index, path.indexOf('.', index))),\r\n\t\t\texports: context(path), \r\n\t\t};\r\n\t});\r\n}\r\n\r\nfunction register(type, context)\r\n{\r\n\tfor(let file of requireAll(context))\r\n\t{\r\n\t\tapp[type](file.exports.name || file.name, file.exports);\r\n\t}\r\n}\r\n\r\nfunction registerSpecial(type, context)\r\n{\r\n\tfor(let file of requireAll(context))\r\n\t{\r\n\t\tapp[type](file.exports);\r\n\t}\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/main.js\n// module id = 0\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/style/main.css\n// module id = 1\n// module chunks = 0","module.exports = function(obj) {\n    if (typeof obj === 'string') return camelCase(obj);\n    return walk(obj);\n};\n\nfunction walk (obj) {\n    if (!obj || typeof obj !== 'object') return obj;\n    if (isDate(obj) || isRegex(obj)) return obj;\n    if (isArray(obj)) return map(obj, walk);\n    return reduce(objectKeys(obj), function (acc, key) {\n        var camel = camelCase(key);\n        acc[camel] = walk(obj[key]);\n        return acc;\n    }, {});\n}\n\nfunction camelCase(str) {\n    return str.replace(/[_.-](\\w|$)/g, function (_,x) {\n        return x.toUpperCase();\n    });\n}\n\nvar isArray = Array.isArray || function (obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n};\n\nvar isDate = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object Date]';\n};\n\nvar isRegex = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object RegExp]';\n};\n\nvar has = Object.prototype.hasOwnProperty;\nvar objectKeys = Object.keys || function (obj) {\n    var keys = [];\n    for (var key in obj) {\n        if (has.call(obj, key)) keys.push(key);\n    }\n    return keys;\n};\n\nfunction map (xs, f) {\n    if (xs.map) return xs.map(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        res.push(f(xs[i], i));\n    }\n    return res;\n}\n\nfunction reduce (xs, f, acc) {\n    if (xs.reduce) return xs.reduce(f, acc);\n    for (var i = 0; i < xs.length; i++) {\n        acc = f(acc, xs[i], i);\n    }\n    return acc;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/camelize/index.js\n// module id = 5\n// module chunks = 0","var map = {\n\t\"./component/app/app.component.js\": 7\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 6;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.component\\.js$/\n// module id = 6\n// module chunks = 0","module.exports = {\r\n\ttemplate: require('./app.html'),\r\n\tcontroller($scope, $sce, Parser, StoryService, Context)\r\n\t{\r\n\t\tvar $ctrl = this;\r\n\t\t\r\n\t\tStoryService.load('story/main.xml', Context())\r\n\t\t\t.then(story =>\r\n\t\t\t{\r\n\t\t\t\twindow.STORY = story;\r\n\t\t\t\t\r\n\t\t\t\t$ctrl.story = story;\r\n\t\t\t\tStoryService.prepare(story);\r\n\t\t\t});\r\n\t\t\r\n\t\tvar cache = {};\r\n\t\t$ctrl.display = function(text)\r\n\t\t{\r\n\t\t\tif(text in cache)\r\n\t\t\t{\r\n\t\t\t\treturn cache[text];\r\n\t\t\t}\r\n\t\t\tif(text && $ctrl.story)\r\n\t\t\t{\r\n\t\t\t\treturn cache[text] = $sce.trustAsHtml(Parser.parse(text, $ctrl.story.context));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t$ctrl.travel = function(path)\r\n\t\t{\r\n\t\t\tcache = {};\r\n\t\t\t$ctrl.story.travel(path);\r\n\t\t\tStoryService.save($ctrl.story);\r\n\t\t}\r\n\t\t\r\n\t\t$ctrl.reset = function()\r\n\t\t{\r\n\t\t\tcache = {};\r\n\t\t\tStoryService.reset($ctrl.story);\r\n\t\t}\r\n\t\t\r\n\t\twindow.TRAVEL = function(path) {\r\n\t\t\t$scope.$apply(function() {\r\n\t\t\t\t$ctrl.travel(path);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/component/app/app.component.js\n// module id = 7\n// module chunks = 0","module.exports = \"<div class=\\\"text-center\\\">\\r\\n    <div class=\\\"jumbotron\\\" ng-style=\\\"{background:'hsl(' + $ctrl.story.context.scope['ui:hue'] + ', 20%, 90%)'}\\\">\\r\\n        <h1 class=\\\"display-3 text-center header\\\" ng-bind=\\\"$ctrl.display('{ui:title}')\\\"></h1>\\r\\n        <p class=\\\"text-muted lead\\\" ng-bind=\\\"$ctrl.display('{ui:subtitle}')\\\"></p>\\r\\n        <a class=\\\"small pt-3\\\" ng-click=\\\"$ctrl.reset()\\\" href=\\\"\\\">Create new story</a>\\r\\n    </div>\\r\\n    <div class=\\\"container pb-5\\\">\\r\\n    \\t<p class=\\\"text-center py-5\\\" ng-bind-html=\\\"$ctrl.display($ctrl.story.event.text)\\\"></p>\\r\\n        <div ng-repeat=\\\"path in $ctrl.story.event.paths\\\" ng-if=\\\"!path.condition || path.condition()\\\">\\r\\n            <div class=\\\"btn d-block py-3 mt-3 mx-5\\\" ng-class=\\\"{'text-muted':path.traveled}\\\" ng-style=\\\"{background:'hsl(' + $ctrl.story.context.scope['ui:hue'] + ', 20%, 90%)'}\\\" ng-bind-html=\\\"$ctrl.display(path.text)\\\" ng-click=\\\"$ctrl.travel(path)\\\"></div>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/component/app/app.html\n// module id = 8\n// module chunks = 0","function webpackContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackContext.keys = function() { return []; };\nwebpackContext.resolve = webpackContext;\nmodule.exports = webpackContext;\nwebpackContext.id = 9;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.directive\\.js$/\n// module id = 9\n// module chunks = 0","function webpackContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackContext.keys = function() { return []; };\nwebpackContext.resolve = webpackContext;\nmodule.exports = webpackContext;\nwebpackContext.id = 10;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.provider\\.js$/\n// module id = 10\n// module chunks = 0","function webpackContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackContext.keys = function() { return []; };\nwebpackContext.resolve = webpackContext;\nmodule.exports = webpackContext;\nwebpackContext.id = 11;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.constant\\.js$/\n// module id = 11\n// module chunks = 0","function webpackContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackContext.keys = function() { return []; };\nwebpackContext.resolve = webpackContext;\nmodule.exports = webpackContext;\nwebpackContext.id = 12;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.value\\.js$/\n// module id = 12\n// module chunks = 0","var map = {\n\t\"./service/story.service.js\": 14,\n\t\"./service/xml-context.service.js\": 15\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 13;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.service\\.js$/\n// module id = 13\n// module chunks = 0","module.exports = function StoryService($http, Util, Storage, XmlContextService)\r\n{\r\n\tthis.load = function(path, context)\r\n\t{\r\n\t\treturn XmlContextService.load(path, context)\r\n\t\t\t.then(context =>\r\n\t\t\t{\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcontext,\r\n\t\t\t\t\teventStack: [],\r\n\t\t\t\t\tevent: null,\r\n\t\t\t\t\tstep: 0,\r\n\t\t\t\t\ttravel(path)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// context.assign('visit:' + path.ref, this.step);\r\n\t\t\t\t\t\tthis.step++;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// var ref = Array.isArray(path.ref) ? Util.pick(path.ref) : path.ref;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar ref;\r\n\t\t\t\t\t\tif(typeof path === 'string')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tref = path;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tpath.traveled = true;\r\n\t\t\t\t\t\t\tref = Util.pick(path.ref.split(','));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(ref == '*')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis.eventStack.shift();\r\n\t\t\t\t\t\t\tthis.event = this.eventStack[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis.event = context.findEvent(ref);\r\n\t\t\t\t\t\t\tif(this.event.scene)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tthis.eventStack.unshift(this.event);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif(this.event.assignments)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tfor(var id in this.event.assignments)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tcontext.assign(id, this.event.assignments[id]);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.eventStack[0] = this.event;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tthis.prepare = function(story)\r\n\t{\r\n\t\tstory.context.scope = Storage.load('scope') || {};\r\n\t\tstory.travel({ref: story.context.exists('event:save') ? story.context.get('event:save') : 'start'});\r\n\t\t\r\n\t\tconsole.log('Loaded scope:', story.context.scope);\r\n\t}\r\n\t\r\n\tthis.save = function(story)\r\n\t{\r\n\t\tstory.context.assign('event:save', story.event.id);\r\n\t\tStorage.save('scope', story.context.scope);\r\n\t}\r\n\t\r\n\tthis.reset = function(story)\r\n\t{\r\n\t\tStorage.save('scope', undefined);\r\n\t\tthis.prepare(story);\r\n\t}\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/service/story.service.js\n// module id = 14\n// module chunks = 0","var angular = window.angular;\r\nvar $ = angular.element;\r\n\r\nmodule.exports = function XmlContextService($http, $q, Util, Parser)\r\n{\r\n\tthis.load = function(path, context)\r\n\t{\r\n\t\treturn $http.get(path)\r\n\t\t\t.then(response => this.parse(response.data, path, context));\r\n\t};\r\n\t\r\n\tthis.parse = function(data, path, context)\r\n\t{\r\n\t\tconsole.log('Parsing resource: ' + path);\r\n\t\t\r\n\t\tvar $data = $(data);\r\n\t\tvar tasks = [];\r\n\t\ttasks.push(parseAll($data.children('import'), $elem =>\r\n\t\t{\r\n\t\t\tvar importPath = $elem.attr('path');\r\n\t\t\tif(!importPath)\r\n\t\t\t{\r\n\t\t\t\tthrow new Error('No import path: `' + $elem[0] + '`');\r\n\t\t\t}\r\n\t\t\timportPath = /^([a-z]+:)?\\/\\//i.test($elem.path) ? importPath : path.substring(0, path.lastIndexOf('/') + 1) + importPath;\r\n\t\t\treturn this.load(importPath, context);\r\n\t\t}));\r\n\t\ttasks.push(parseAll($data.children('composer'), $elem =>\r\n\t\t{\r\n\t\t\tvar composer = {\r\n\t\t\t\tid: $elem.attr('id'),\r\n\t\t\t\toptions: [],\r\n\t\t\t\tgenerate(name)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar value = Util.pick(this.options);\r\n\t\t\t\t\tif(name && !context.exists(this.id + ':' + name))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcontext.assign(this.id + ':' + name, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t\t$elem.children('option').each((i, e) => composer.options.push(parseText($(e).html(), context)));\r\n\t\t\tcontext.addComposer(composer);\r\n\t\t\treturn composer;\r\n\t\t}));\r\n\t\ttasks.push(parseAll($data.children('event'), $elem =>\r\n\t\t{\r\n\t\t\tvar event = {\r\n\t\t\t\tid: $elem.attr('id'),\r\n\t\t\t\tcontext: null,\r\n\t\t\t\tassignments: {},\r\n\t\t\t\ttext: parseText($elem.children('show').html(), context),\r\n\t\t\t\tpaths: [],\r\n\t\t\t};\r\n\t\t\tcrawlEvent($elem, event, context);\r\n\t\t\tcontext.addEvent(event);\r\n\t\t\treturn event;\r\n\t\t}));\r\n\t\treturn $q.all(tasks)\r\n\t\t\t.then(() => context);\r\n\t}\r\n\t\r\n\tfunction parseAll($query, builder)\r\n\t{\r\n\t\tvar array = [];\r\n\t\t$query.each((i, elem) => array.push(builder($(elem))));\r\n\t\treturn $q.all(array);\r\n\t}\r\n\t\r\n\tfunction parseText(text, context)\r\n\t{\r\n\t\treturn text;\r\n\t}\r\n\t\r\n\tfunction crawlEvent($elem, event, context, condition)\r\n\t{\r\n\t\tvar ifCondition;\r\n\t\t$elem.children().each((i, e) =>\r\n\t\t{\r\n\t\t\tvar tag = e.tagName.toLowerCase();\r\n\t\t\tif(tag === 'if')\r\n\t\t\t{\r\n\t\t\t\tvar key = e.getAttribute('key');\r\n\t\t\t\tvar value = e.getAttribute('value');\r\n\t\t\t\tvar invert = e.hasAttribute('invert');\r\n\t\t\t\t\r\n\t\t\t\tvar cond = ifCondition = () => (value != null\r\n\t\t\t\t\t\t? (context.exists(key) ? context.get(key) : '') == Parser.parse(value, context)\r\n\t\t\t\t\t\t: context.exists(key) && !!context.get(key)) != invert;\r\n\t\t\t\treturn crawlEvent($(e), event, context, cond);\r\n\t\t\t}\r\n\t\t\telse if(tag === 'else')\r\n\t\t\t{\r\n\t\t\t\tif(!ifCondition)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Invalid `else` positioning');\r\n\t\t\t\t}\r\n\t\t\t\tvar cond = ifCondition;\r\n\t\t\t\tifCondition = null;\r\n\t\t\t\treturn crawlEvent($(e), event, context, () => !cond());\r\n\t\t\t}\r\n\t\t\tif(tag === 'show')\r\n\t\t\t{\r\n\t\t\t\tevent.text = parseText(e.innerHTML, context);\r\n\t\t\t}\r\n\t\t\telse if(tag === 'path')\r\n\t\t\t{\r\n\t\t\t\tevent.paths.push({\r\n\t\t\t\t\tref: e.getAttribute('ref'),\r\n\t\t\t\t\tappend: e.hasAttribute('append'),////\r\n\t\t\t\t\tcondition,\r\n\t\t\t\t\ttext: parseText(e.innerHTML, context),\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if(tag === 'scene')\r\n\t\t\t{\r\n\t\t\t\tevent.scene = {};\r\n\t\t\t}\r\n\t\t\telse if(tag === 'assign')\r\n\t\t\t{\r\n\t\t\t\tvar assignments = event.assignments || (event.assignments = {});\r\n\t\t\t\tassignments[e.getAttribute('key')] = e.getAttribute('value');\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/service/xml-context.service.js\n// module id = 15\n// module chunks = 0","var map = {\n\t\"./factory/context.factory.js\": 17,\n\t\"./factory/parser.factory.js\": 18,\n\t\"./factory/range-composer.factory.js\": 19,\n\t\"./factory/storage.factory.js\": 20,\n\t\"./factory/util.factory.js\": 21\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 16;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.factory\\.js$/\n// module id = 16\n// module chunks = 0","module.exports = function Context(Parser, RangeComposer)\r\n{\r\n\treturn function(parent)\r\n\t{\r\n\t\treturn {\r\n\t\t\tcomposers: {\r\n\t\t\t\trange: RangeComposer,\r\n\t\t\t},\r\n\t\t\tevents: {},\r\n\t\t\tscope: {},\r\n\t\t\taddComposer(composer)\r\n\t\t\t{\r\n\t\t\t\tif(!composer.id)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Invalid composer: ' + JSON.stringify(composer));\r\n\t\t\t\t}\r\n\t\t\t\tif(this.composers[composer.id])\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Composer already exists: `' + composer.id + '`');\r\n\t\t\t\t}\r\n\t\t\t\tthis.composers[composer.id] = composer;\r\n\t\t\t},\r\n\t\t\tfindComposer(id)\r\n\t\t\t{\r\n\t\t\t\tvar composer = this.composers[id];\r\n\t\t\t\tif(!composer)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Composer does not exist: `' + id + '`');\r\n\t\t\t\t}\r\n\t\t\t\treturn composer;\r\n\t\t\t},\r\n\t\t\taddEvent(event)\r\n\t\t\t{\r\n\t\t\t\tif(!event.id)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Invalid event: ' + JSON.stringify(event));\r\n\t\t\t\t}\r\n\t\t\t\tvar prevEvent = this.events[event.id];\r\n\t\t\t\tif(event.append)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(!prevEvent)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthrow new Error('No existing append target: `' + event.id + '`');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(var key in event)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar value = event[key];\r\n\t\t\t\t\t\tif(Array.isArray(value) && Array.isArray(prevEvent[key]))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t[].push.apply(prevEvent[key], value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tprevEvent[key] = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if(prevEvent)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Event already exists: `' + prevEvent.id + '`');\r\n\t\t\t\t}\r\n\t\t\t\tthis.events[event.id] = event;\r\n\t\t\t},\r\n\t\t\tfindEvent(id)\r\n\t\t\t{\r\n\t\t\t\tvar event = this.events[id];\r\n\t\t\t\tif(!event)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Event does not exist: `' + id + '`');\r\n\t\t\t\t}\r\n\t\t\t\treturn event;\r\n\t\t\t},\r\n\t\t\texists(id)\r\n\t\t\t{\r\n\t\t\t\treturn !!this.scope[id];\r\n\t\t\t},\r\n\t\t\tget(id)\r\n\t\t\t{\r\n\t\t\t\tvar value = this.scope[id];\r\n\t\t\t\tif(!value)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error('Value is not defined: `' + id + '`');\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\t\t\tassign(id, value)\r\n\t\t\t{\r\n\t\t\t\tthis.scope[id] = Parser.parse(value, this); /// parse or leave?\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/factory/context.factory.js\n// module id = 17\n// module chunks = 0","module.exports = function Parser($injector, Util)\r\n{\r\n\treturn {\r\n\t\tparse(text, context)\r\n\t\t{\r\n\t\t\treturn String(text)\r\n\t\t\t\t.replace(/{([^}]+)}/g, ($0, $1) => this.eval($1, context))\r\n\t\t\t\t.replace(/(=)?\"[^\"]+\"/g, ($0, $1) => $1 ? $0 : wrap('msg-quotes')($0))\r\n\t\t\t\t.replace(/~[^~]+~/g, wrap('msg-occurrence'))\r\n\t\t\t\t.replace(/\\*([^*]+)\\*/g, wrap('msg-bold'))\r\n\t\t\t\t.replace(/_([^_]+)_/g, wrap('msg-italics'))\r\n\t\t\t\t.replace(/\\^([^_]+)\\^/g, wrap('msg-uppercase'));\r\n\t\t},\r\n\t\teval(id, context)\r\n\t\t{\r\n\t\t\tif(!context)\r\n\t\t\t{\r\n\t\t\t\tthrow new Error('Context required to evaluate `' + id + '`');\r\n\t\t\t}\r\n\t\t\tif(id.indexOf(':') === -1)\r\n\t\t\t{\r\n\t\t\t\treturn this.parse(context.findComposer(id).generate(), context);\r\n\t\t\t}\r\n\t\t\tvar delimIndex = id.indexOf(':');\r\n\t\t\tvar composerID = id.substring(0, delimIndex);\r\n\t\t\tvar keyID = id.substring(delimIndex + 1);\r\n\t\t\tvar value;\r\n\t\t\tif(context.exists(id))\r\n\t\t\t{\r\n\t\t\t\tvalue = context.get(id);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvar composer = context.findComposer(composerID);\r\n\t\t\t\tvalue = this.parse(composer.generate(keyID), context);\r\n\t\t\t\t// if(!composer.dynamic)\r\n\t\t\t\t// {\r\n\t\t\t\t// \tcontext.assign(id, value);\r\n\t\t\t\t// }\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t},\r\n\t};\r\n\t\r\n\tfunction wrap(type)\r\n\t{\r\n\t\treturn ($0, $1) => '<span class=\"' + type + '\">' + ($1 || $0) + '</span>';\r\n\t}\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/factory/parser.factory.js\n// module id = 18\n// module chunks = 0","module.exports = function RangeComposer()\r\n{\r\n\treturn {\r\n\t\t// dynamic: true,\r\n\t\tgenerate(value)\r\n\t\t{\r\n\t\t\tvar min = 0, max = 0;\r\n\t\t\tif(value)\r\n\t\t\t{\r\n\t\t\t\tvar index = value.indexOf('-');\r\n\t\t\t\tmin = +value.substring(0, index);\r\n\t\t\t\tmax = +value.substring(index + 1);\r\n\t\t\t}\r\n\t\t\treturn Math.round(Math.random() * (max - min)) + min;\r\n\t\t},\r\n\t};\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/factory/range-composer.factory.js\n// module id = 19\n// module chunks = 0","module.exports = function Storage($window)\r\n{\r\n\treturn {\r\n\t\tload(key)\r\n\t\t{\r\n\t\t\tvar data = $window.localStorage.getItem(key);\r\n\t\t\tif(data) return JSON.parse(data);\r\n\t\t},\r\n\t\tsave(key, data)\r\n\t\t{\r\n\t\t\t$window.localStorage.setItem(key, data != null ? JSON.stringify(data) : '');\r\n\t\t},\r\n\t};\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/factory/storage.factory.js\n// module id = 20\n// module chunks = 0","module.exports = function Util()\r\n{\r\n\treturn {\r\n\t\tpick(arr)\r\n\t\t{\r\n\t\t\treturn arr[Math.floor(Math.random() * arr.length)];\r\n\t\t},\r\n\t};\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app/factory/util.factory.js\n// module id = 21\n// module chunks = 0","function webpackContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackContext.keys = function() { return []; };\nwebpackContext.resolve = webpackContext;\nmodule.exports = webpackContext;\nwebpackContext.id = 22;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.filter\\.js$/\n// module id = 22\n// module chunks = 0","function webpackContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackContext.keys = function() { return []; };\nwebpackContext.resolve = webpackContext;\nmodule.exports = webpackContext;\nwebpackContext.id = 23;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.run\\.js$/\n// module id = 23\n// module chunks = 0","function webpackContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackContext.keys = function() { return []; };\nwebpackContext.resolve = webpackContext;\nmodule.exports = webpackContext;\nwebpackContext.id = 24;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./www/app \\.config\\.js$/\n// module id = 24\n// module chunks = 0"],"sourceRoot":""}